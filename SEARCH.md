# البحث العالمي داخل المنصة

مسار البحث داخل المنصة يوفّر طريقة سريعة للعثور على:

- العملاء (Clients)
- القضايا (Matters)
- المستندات (Documents)
- المهام (Tasks)

## أين أستخدمه؟

- صفحة الواجهة: `/app/search`
- API: `GET /app/api/search?q=...`

## ماذا يبحث؟

يعتمد البحث على `ILIKE` مع نطاق المكتب (org) وقيود RLS:

- **العملاء**: `name`, `email`, `phone`
- **القضايا**: `title`, `summary`
- **المستندات**: `title`, `description`
- **المهام**: `title`, `description`

كل مجموعة ترجع بحد أقصى **10 نتائج**.

## الخصوصية والعزل

- كل الاستعلامات تستخدم Supabase **Session client** (بدون Service Role) لذلك **RLS** تمنع أي تسريب بين المكاتب.
- القضايا/المستندات/المهام المرتبطة بقضايا خاصة لن تظهر إلا للأعضاء المصرّح لهم وفق السياسات الحالية.
- لا يتم إرجاع محتوى طويل: يتم تقصير أي `summary/description` إلى 120 حرفًا كحد أقصى.

## التحقق وحدود الاستخدام

- `q` مطلوب
- الحد الأدنى: حرفان (2)
- الحد الأقصى: 80
- إذا كان البحث غير صالح ترجع رسالة:
  - `اكتب كلمتين على الأقل للبحث.`

Rate Limit:
- `60` طلب لكل IP خلال `10` دقائق على مسار `/app/api/search`

## فهارس اختيارية

يوجد Migration اختياري لإضافة فهارس بحث أساسية:
- `supabase/migrations/0013_search_indexes.sql`

