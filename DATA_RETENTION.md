# سياسة الاحتفاظ بالبيانات (Phase 9.2.1)

هذا المستند يوضح سياسة الاحتفاظ بالبيانات في **مسار المحامي** (MVP) وما يدعمه النظام حاليًا فيما يخص الأرشفة وطلبات الحذف.

> مهم: لا يوجد حذف تلقائي للبيانات داخل المنصة في النسخة الحالية. الحذف يتم يدويًا فقط بعد التحقق.

## 1) مبادئ عامة
- **العزل حسب المكتب (org_id):** جميع بيانات المنصة معزولة لكل مكتب عبر Supabase RLS.
- **الأرشفة بدل الحذف:** في الوحدات الأساسية (العملاء/القضايا) نستخدم “أرشفة” للحفاظ على السجل.
- **الروابط العامة للمستندات مؤقتة:** المشاركة تتم عبر `document_shares` مع تاريخ انتهاء.

## 2) ما الذي يُحتفَظ به؟

### أ) الحسابات والهوية
- `auth.users` (Supabase Auth): حسابات المستخدمين.
- `profiles`: الاسم ورقم الجوال (اختياري).
- `memberships`: عضوية المستخدم داخل المكتب ودوره.

### ب) العملاء (Clients)
- لا يوجد حذف تلقائي.
- يوجد حقل `status`:
  - `active` (نشط)
  - `archived` (مؤرشف)
- الأرشفة تُخفي العميل من القوائم الافتراضية لكنها لا تحذف بياناته.

### ج) القضايا (Matters)
- لا يوجد حذف تلقائي.
- يوجد حقل `status` يشمل `archived`.
- القضايا الخاصة (`is_private = true`) لا تظهر إلا للمالك/الأعضاء المصرّح لهم (وفق RLS).

### د) المستندات (Documents)
- الملفات محفوظة في Supabase Storage bucket: `documents` (خاص).
- الوصول للملفات عبر Signed URLs فقط.
- النسخ محفوظة في `document_versions` (لا يوجد حذف تلقائي).
- روابط المشاركة (`/share/[token]`) تنتهي تلقائيًا حسب `expires_at`.

### هـ) المهام (Tasks)
- لا يوجد حذف تلقائي.
- تحديث الحالة يتم عبر `status` (todo/doing/done/canceled).

### و) الفوترة (Quotes / Invoices / Payments)
- لا يوجد حذف تلقائي.
- ينصح بالاحتفاظ بالسجلات المالية لمدة مناسبة حسب متطلبات المكتب والتنظيم المحلي.

### ز) سجل التدقيق (Audit Logs)
- لا يوجد حذف تلقائي.
- السجل يهدف لتتبع العمليات الحساسة، ويظهر للمالك فقط.

### ح) طلبات التواصل/التفعيل
- `full_version_requests` تُستخدم لتسجيل:
  - طلب تفعيل/اشتراك
  - طلب حذف بيانات المكتب (`type = delete_request`)
- هذه الطلبات ليست قابلة للقراءة من العميل (لا يوجد SELECT policy) وهي للاستخدام التشغيلي فقط.

## 3) طلب حذف بيانات المكتب (يدوي)
- متاح للمالك فقط عبر:
  - `/app/settings/privacy`
- عند الإرسال يتم إنشاء سجل في `full_version_requests` بنوع:
  - `type = 'delete_request'`
- التنفيذ **يدوي** بعد التحقق من هوية المالك وصلاحيته.

## 4) نطاق الحذف والتوقعات
- قد يتم طلب معلومات إضافية لتأكيد الهوية قبل تنفيذ الحذف.
- قد تختلف مدة تنفيذ الحذف حسب حجم البيانات وتعقيدها.
- في مرحلة الـMVP لا نقدم التزامًا بزمن استجابة ثابت دون أتمتة للنسخ/الاستعادة.

## 5) التواصل
- لأي استفسار يتعلق بالخصوصية/الحذف:
  - `masar.almohami@outlook.sa`

